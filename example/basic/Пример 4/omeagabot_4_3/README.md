# Пример 4.3 - Фильтруем даные (Вариант 2 - продвинутый)

Данный пример продолжает пример 4.2 и реализует считывание и фильтрацию данных при помощи прерывания на Wachdog таймер (WDT). Это делает программу независимой от долгих циклов и delay в основном цикле программы, но также имеет свои подводные камни.

## Описание работы программы

1. Определение пина и глобальной переменной:
   - Программа определяет пин подключения ИК-датчика (#define IR_PIN).
   - Создается глобальная переменная filtered_measur с модификатором volatile. Этот модификатор указывает компилятору, что значение этой переменной может изменяться вне основного потока выполнения программы, например, в прерываниях.

2. Прерывание на Watchdog Timer (WDT):
   - Настраивается функция обработки прерывания ISR(WDT_vect) для Watchdog Таймера. Эта функция вызывается каждый раз, когда срабатывает прерывание WDT. Внутри функции выполняется чтение показаний с ИК-датчика и применение фильтра для сглаживания этих показаний.

3. Функция преобразования показаний в расстояние:
   - Функция Read_IR принимает отфильтрованное показание и конвертирует его в расстояние в сантиметрах.

4. Настройка программы в `setup()`:
   - В функции setup() настраиваются параметры работы программы:
     - Устанавливается связь с компьютером через последовательный порт (Serial.begin(9600)).
     - Выполняется настройка Watchdog Таймера (WDT):
       - Прерывания временно отключаются командой cli().
       - Команда asm("wdr") сбрасывает WDT.
       - Команды WDTCSR = (1 << WDCE) | (1 << WDE) разрешают изменение параметров WDT.
       - Устанавливается частота срабатывания WDT. В данном случае выбрана частота 16 Гц (период ≈64 мс), что соответствует настройкам WDTCSR = 0 | (1 << WDP1) | (1 << WDIE ).
       - После завершения настройки прерывания снова включаются командой sei().

5. Основной цикл программы в `loop()`:
   - В основном цикле программы выполняются следующие действия:
     - Программа ожидает одну секунду (delay(1000)).
     - Вызывается функция Read_IR, которая рассчитывает расстояние на основе отфильтрованных показаний.
     - Рассчитанное расстояние отправляется в последовательный порт для отображения на компьютере.

Таким образом, программа непрерывно измеряет расстояние с использованием ИК-датчика, применяя фильтр для сглаживания показаний в обработчике прерывания WDT, а затем выводит результат в последовательный порт.