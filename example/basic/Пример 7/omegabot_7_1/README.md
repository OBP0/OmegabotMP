# Пример 7.1 - Восстание машин

В данном рпимере показано, как заставить робота управлять сервоприводом при помощи смартфона через Bluetooth. Это может быть ковш, схват или же просто привод УЗ датчика или камеры.

## Описание кода:

1. Определение констант и переменных

В начале программы определяются несколько констант и глобальных переменных.

2. Настройка в функции setup

Функция setup() выполняется один раз при запуске программы:

- Открывается последовательный порт (Serial) со скоростью передачи данных 9600 бод.
- Серво двигатель инициализируется с помощью метода attach, который связывает объект servo_1 с указанным пином.
- Устанавливается начальный угол поворота серво двигателя.

3. Основная логика в функции loop

Функция loop() выполняется непрерывно после завершения выполнения функции setup.

Шаг 1: Получение команд

Программа проверяет наличие данных в последовательном порте с помощью функции Serial.available. Если данные доступны, то программа считывает байт и анализирует команду:

- Если получена команда 'U' или 'D', она сохраняется в переменной cmd, а таймер актуальности команды сбрасывается.
  
Шаг 2: Обработка команд

На основе текущей команды выполняются следующие действия:

- Если команда равна 'U', то рассчитывается новый угол поворота серводвигателя с учётом скорости вращения и прошедшего времени. Затем устанавливается ограничение углов поворота и отправляется новая команда на сервопривод.
- Аналогично, если команда равна 'D', угол уменьшается с учётом ограничения углов.

Шаг 3: Проверка актуальности команды

Если прошло больше времени, чем определено в COMMAND_ACTUAL_TIME, и новых команд не поступало, то текущая команда сбрасывается, и сервопривод останавливается.

Таким образом, программа получает команды через последовательный порт, обрабатывает их, управляя углом поворота серводвигателя, и следит за тем, чтобы команды оставались актуальными в течение заданного времени.


## Приложение для телефона

Для разработки данного примера использовалось приложение [Bluetooth Commander v 9.7](https://play.google.com/store/apps/details?id=masar.gbc&pcampaignid=web_share).

В приложении была выбрана режим джойстика, где каждая кнопка соответствовала определенной команде:

- Кнопка "треугольник" Text(U) для подъема сервы,
- Кнопка "крестик" Text(D) для опускания сервы,

Для всех кнопок был установлен режим периодической отправки команд с интервалом в 50 мс.

Кроме того, в настройках самого джойстика был активирован режим периодической отправки по удерживанию, вместо стандартного режима фиксации по нажатию. Этот режим гарантирует непрерывную отправку команд до тех пор, пока пользователь держит кнопку нажатой, что особенно полезно для плавного управления движением робота.